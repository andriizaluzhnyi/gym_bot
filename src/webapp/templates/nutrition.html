<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ë–ñ–£ –ú–æ–Ω—ñ—Ç–æ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #0a0a0a;
            --card-bg: #1a1a1a;
            --card-border: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --text-muted: #666666;
            --accent-green: #4ade80;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--tg-theme-bg-color, var(--bg-color));
            color: var(--tg-theme-text-color, var(--text-primary));
            min-height: 100vh;
            padding: 12px;
            padding-bottom: 90px;
        }

        .date {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--tg-theme-text-color, var(--text-primary));
        }

        .card {
            background-color: var(--tg-theme-secondary-bg-color, var(--card-bg));
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
        }

        /* Calories Section */
        .calories-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .calories-ring {
            position: relative;
            width: 90px;
            height: 90px;
            flex-shrink: 0;
        }

        .calories-ring svg {
            transform: rotate(-90deg);
            width: 90px;
            height: 90px;
        }

        .calories-ring circle {
            fill: none;
            stroke-width: 6;
        }

        .calories-ring .bg {
            stroke: var(--card-border);
        }

        .calories-ring .protein-progress {
            stroke: #3b82f6;
            stroke-linecap: round;
            stroke-dasharray: 251;
            stroke-dashoffset: 251;
            transition: stroke-dashoffset 0.5s ease;
        }

        .calories-ring .fat-progress {
            stroke: #f59e0b;
            stroke-linecap: round;
            stroke-dasharray: 207;
            stroke-dashoffset: 207;
            transition: stroke-dashoffset 0.5s ease;
        }

        .calories-ring .carbs-progress {
            stroke: #10b981;
            stroke-linecap: round;
            stroke-dasharray: 163;
            stroke-dashoffset: 163;
            transition: stroke-dashoffset 0.5s ease;
        }

        .calories-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .calories-value {
            font-size: 15px;
            font-weight: 700;
            color: var(--tg-theme-text-color, var(--text-primary));
        }

        .calories-label {
            font-size: 10px;
            color: var(--tg-theme-hint-color, var(--text-muted));
        }

        .macros {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }

        .macro-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .macro-name {
            color: var(--tg-theme-hint-color, var(--text-secondary));
            font-size: 14px;
        }

        .macro-name.protein {
            color: #3b82f6;
            font-weight: 500;
        }

        .macro-name.fat {
            color: #f59e0b;
            font-weight: 500;
        }

        .macro-name.carbs {
            color: #10b981;
            font-weight: 500;
        }

        .macro-value {
            font-size: 14px;
            color: var(--tg-theme-hint-color, var(--text-muted));
        }

        /* Water Section */
        .water-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .water-header h3 {
            font-size: 16px;
            font-weight: 500;
            color: var(--tg-theme-text-color, var(--text-primary));
        }

        .water-icon {
            font-size: 18px;
        }

        .water-display {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 16px;
        }

        .water-current {
            font-size: 28px;
            font-weight: 700;
            color: var(--tg-theme-text-color, var(--text-primary));
        }

        .water-total {
            color: var(--tg-theme-hint-color, var(--text-muted));
            font-size: 16px;
        }

        .water-progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--card-border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .water-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .water-progress-fill.over-goal {
            background: linear-gradient(90deg, #60a5fa 0%, #3b82f6 100%);
        }

        .water-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .water-btn {
            background-color: var(--card-border);
            border: none;
            border-radius: 20px;
            padding: 10px 16px;
            color: var(--tg-theme-hint-color, var(--text-secondary));
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
        }

        .water-btn.undo-water {
            /* background-color: #ff6b6b; */
            color: #ffffff;
        }

        .water-btn.undo-water:disabled {
            background-color: var(--card-border);
            color: var(--text-muted);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .water-btn:active {
            transform: scale(0.95);
            background-color: var(--tg-theme-button-color, var(--accent-green));
            color: var(--tg-theme-button-text-color, #000);
        }

        /* Meals Section */
        .meals-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .meals-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--tg-theme-text-color, var(--text-primary));
        }

        .meals-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
        }

        .edit-btn {
            background-color: var(--card-border);
            color: var(--tg-theme-hint-color, var(--text-secondary));
        }

        .photo-btn {
            background-color: var(--tg-theme-button-color, var(--accent-green));
            color: var(--tg-theme-button-text-color, #000);
            padding: 10px 16px;
            border-radius: 20px;
            width: auto;
            font-size: 14px;
            font-weight: 500;
            gap: 6px;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .empty-state {
            text-align: center;
            padding: 30px 0;
        }

        .empty-state p {
            color: var(--tg-theme-hint-color, var(--text-muted));
            margin-bottom: 4px;
        }

        .empty-state .subtitle {
            font-size: 14px;
            color: var(--tg-theme-hint-color, var(--text-muted));
            opacity: 0.7;
        }

        /* Meals List */
        .meal-item {
            background-color: var(--tg-theme-secondary-bg-color, var(--card-bg));
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 10px;
            border: 1px solid var(--card-border);
        }

        .meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .meal-time {
            font-size: 13px;
            color: var(--tg-theme-hint-color, var(--text-muted));
        }

        .meal-calories {
            font-size: 16px;
            font-weight: 600;
            color: var(--tg-theme-text-color, var(--text-primary));
        }

        .meal-macros {
            display: flex;
            gap: 12px;
        }

        .meal-macro {
            font-size: 13px;
            color: var(--tg-theme-hint-color, var(--text-secondary));
        }

        .meal-macro.protein {
            color: #3b82f6;
        }

        .meal-macro.fat {
            color: #f59e0b;
        }

        .meal-macro.carbs {
            color: #10b981;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--tg-theme-secondary-bg-color, var(--card-bg));
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            padding-bottom: calc(12px + env(safe-area-inset-bottom, 0));
            border-top: 1px solid var(--card-border);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--tg-theme-hint-color, var(--text-muted));
            text-decoration: none;
            font-size: 11px;
            -webkit-tap-highlight-color: transparent;
            transition: color 0.2s;
        }

        .nav-item.active {
            color: var(--tg-theme-button-color, var(--accent-green));
        }

        .nav-icon {
            font-size: 20px;
        }

        /* Haptic feedback simulation */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="date" id="currentDate">24 —Å—ñ—á–Ω—è</div>

    <div class="card">
        <div class="water-header">
            <span class="water-icon">üíß</span>
            <h3>–í–æ–¥–∞</h3>
        </div>
        <div class="water-display">
            <span class="water-current" id="waterCurrent">0 –º–ª</span>
            <span class="water-total" id="waterGoal">/ 2500 –º–ª</span>
        </div>
        <div class="water-progress-bar">
            <div class="water-progress-fill" id="waterProgressFill"></div>
        </div>
        <div class="water-buttons">
            <button class="water-btn" data-amount="100">+100 –º–ª</button>
            <button class="water-btn" data-amount="200">+200 –º–ª</button>
            <button class="water-btn" data-amount="250">+250 –º–ª</button>
            <button class="water-btn" data-amount="500">+500 –º–ª</button>
            <button class="water-btn undo-water" id="undoWaterBtn" disabled>‚Ü©Ô∏è –í—ñ–¥–º—ñ–Ω–∏—Ç–∏</button>
        </div>
    </div>

    <div class="card">
        <div class="calories-section">
            <div class="calories-ring">
                <svg viewBox="0 0 100 100">
                    <circle class="bg" cx="50" cy="50" r="40"/>
                    <circle class="bg" cx="50" cy="50" r="33"/>
                    <circle class="bg" cx="50" cy="50" r="26"/>
                    <circle class="protein-progress" id="proteinProgress" cx="50" cy="50" r="40"/>
                    <circle class="fat-progress" id="fatProgress" cx="50" cy="50" r="33"/>
                    <circle class="carbs-progress" id="carbsProgress" cx="50" cy="50" r="26"/>
                </svg>
                <div class="calories-text">
                    <div class="calories-value" id="caloriesValue">0</div>
                    <div class="calories-label">–∫–∫–∞–ª</div>
                </div>
            </div>
            <div class="macros">
                <div class="macro-item">
                    <span class="macro-name protein">–ë—ñ–ª–∫–∏</span>
                    <span class="macro-value" id="proteinValue">0/150 –≥</span>
                </div>
                <div class="macro-item">
                    <span class="macro-name fat">–ñ–∏—Ä–∏</span>
                    <span class="macro-value" id="fatValue">0/80 –≥</span>
                </div>
                <div class="macro-item">
                    <span class="macro-name carbs">–í—É–≥–ª–µ–≤–æ–¥–∏</span>
                    <span class="macro-value" id="carbsValue">0/250 –≥</span>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="meals-header">
            <span class="meals-title">–ü—Ä–∏–π–æ–º–∏ —ó–∂—ñ</span>
            <div class="meals-actions">
                <button class="action-btn edit-btn">‚úèÔ∏è</button>
                <button class="action-btn photo-btn">üì∑ –§–æ—Ç–æ</button>
            </div>
        </div>
        <div class="empty-state" id="mealsEmpty">
            <p>–ù–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤ –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</p>
            <p class="subtitle">–î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π –ø—Ä–∏–π–æ–º —ó–∂—ñ</p>
        </div>
        <div id="mealsList"></div>
    </div>

    <nav class="bottom-nav">
        <a href="/nutrition" class="nav-item active">
            <span class="nav-icon">üìÖ</span>
            <span>–°—å–æ–≥–æ–¥–Ω—ñ</span>
        </a>
        <a href="#" class="nav-item">
            <span class="nav-icon">üìä</span>
            <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
        </a>
        <a href="/profile" class="nav-item">
            <span class="nav-icon">üë§</span>
            <span>–ü—Ä–æ—Ñ—ñ–ª—å</span>
        </a>
        <a href="#" class="nav-item">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</span>
        </a>
    </nav>

    <script>
        // Initialize Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // State
        let waterAmount = 0;
        let waterHistory = []; // History of water changes
        let waterGoal = 2500;
        let caloriesGoal = 2500;
        let proteinGoal = 150;
        let fatsGoal = 80;
        let carbsGoal = 250;
        let currentCalories = 0;
        let currentProtein = 0;
        let currentFats = 0;
        let currentCarbs = 0;

        // User settings from API
        let userSettings = null;

        // Set current date
        function setCurrentDate() {
            const now = new Date();
            const months = [
                '—Å—ñ—á–Ω—è', '–ª—é—Ç–æ–≥–æ', '–±–µ—Ä–µ–∑–Ω—è', '–∫–≤—ñ—Ç–Ω—è', '—Ç—Ä–∞–≤–Ω—è', '—á–µ—Ä–≤–Ω—è',
                '–ª–∏–ø–Ω—è', '—Å–µ—Ä–ø–Ω—è', '–≤–µ—Ä–µ—Å–Ω—è', '–∂–æ–≤—Ç–Ω—è', '–ª–∏—Å—Ç–æ–ø–∞–¥–∞', '–≥—Ä—É–¥–Ω—è'
            ];
            document.getElementById('currentDate').textContent =
                `${now.getDate()} ${months[now.getMonth()]}`;
        }

        // Update macros rings
        function updateMacrosRings() {
            // Protein ring (outer, radius 40)
            const proteinProgressRaw = currentProtein / proteinGoal;
            const proteinProgress = Math.min(proteinProgressRaw, 1.5); // Cap at 150%
            const proteinCircumference = 251;
            const proteinOffset = proteinCircumference - (proteinProgress * proteinCircumference);
            const proteinElement = document.getElementById('proteinProgress');
            proteinElement.style.strokeDashoffset = proteinOffset;
            // Change color when exceeding goal
            if (proteinProgressRaw > 1) {
                proteinElement.style.stroke = '#ef4444'; // Red when over goal
            } else {
                proteinElement.style.stroke = '#3b82f6'; // Blue normal
            }

            // Fat ring (middle, radius 33)
            const fatProgressRaw = currentFats / fatsGoal;
            const fatProgress = Math.min(fatProgressRaw, 1.5); // Cap at 150%
            const fatCircumference = 207;
            const fatOffset = fatCircumference - (fatProgress * fatCircumference);
            const fatElement = document.getElementById('fatProgress');
            fatElement.style.strokeDashoffset = fatOffset;
            // Change color when exceeding goal
            if (fatProgressRaw > 1) {
                fatElement.style.stroke = '#ef4444'; // Red when over goal
            } else {
                fatElement.style.stroke = '#f59e0b'; // Orange normal
            }

            // Carbs ring (inner, radius 26)
            const carbsProgressRaw = currentCarbs / carbsGoal;
            const carbsProgress = Math.min(carbsProgressRaw, 1.5); // Cap at 150%
            const carbsCircumference = 163;
            const carbsOffset = carbsCircumference - (carbsProgress * carbsCircumference);
            const carbsElement = document.getElementById('carbsProgress');
            carbsElement.style.strokeDashoffset = carbsOffset;
            // Change color when exceeding goal
            if (carbsProgressRaw > 1) {
                carbsElement.style.stroke = '#ef4444'; // Red when over goal
            } else {
                carbsElement.style.stroke = '#10b981'; // Green normal
            }

            // Update calories value
            document.getElementById('caloriesValue').textContent = currentCalories;
        }

        // Update macros display
        function updateMacrosDisplay() {
            document.getElementById('proteinValue').textContent = `${currentProtein}/${proteinGoal} –≥`;
            document.getElementById('fatValue').textContent = `${currentFats}/${fatsGoal} –≥`;
            document.getElementById('carbsValue').textContent = `${currentCarbs}/${carbsGoal} –≥`;
        }

        // Update water display
        async function updateWater(amount) {
            const previousAmount = waterAmount;
            waterAmount = Math.max(0, waterAmount + amount);

            // Save to history
            waterHistory.push(previousAmount);
            if (waterHistory.length > 50) {
                waterHistory.shift(); // Keep max 50 items
            }

            // Update UI
            document.getElementById('waterCurrent').textContent = `${waterAmount} –º–ª`;
            document.getElementById('undoWaterBtn').disabled = false;
            updateWaterProgressBar();

            // Haptic feedback
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }

            // Save only the increment to server
            await saveWaterIncrement(amount);
        }

        // Update water goal display
        function updateWaterGoalDisplay() {
            document.getElementById('waterGoal').textContent = `/ ${waterGoal} –º–ª`;
        }

        // Update water progress bar
        function updateWaterProgressBar() {
            const progress = Math.min((waterAmount / waterGoal) * 100, 100);
            const fillElement = document.getElementById('waterProgressFill');
            fillElement.style.width = `${progress}%`;

            // Change color if over goal
            if (waterAmount >= waterGoal) {
                fillElement.classList.add('over-goal');
            } else {
                fillElement.classList.remove('over-goal');
            }
        }

        // Undo last water change
        async function undoWater() {
            if (waterHistory.length > 0) {
                const previousAmount = waterHistory.pop();
                const difference = waterAmount - previousAmount;
                waterAmount = previousAmount;

                document.getElementById('waterCurrent').textContent = `${waterAmount} –º–ª`;
                updateWaterProgressBar();

                if (waterHistory.length === 0) {
                    document.getElementById('undoWaterBtn').disabled = true;
                }

                // Haptic feedback
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('light');
                }

                // Save negative increment to server
                await saveWaterIncrement(-difference);
            }
        }

        // Save water increment to server (not total amount)
        async function saveWaterIncrement(increment) {
            try {
                const response = await fetch('/api/nutrition/daily', {
                    method: 'POST',
                    headers: {
                        'Authorization': tg.initData,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        water_ml: increment,
                        calories: 0,
                        protein: 0,
                        fats: 0,
                        carbs: 0
                    })
                });

                if (!response.ok) {
                    console.error('Failed to save water increment:', response.status);
                }
            } catch (error) {
                console.error('Error saving water increment:', error);
            }
        }

        // Load user settings from API
        async function loadUserSettings() {
            try {
                const response = await fetch('/api/user/settings', {
                    method: 'GET',
                    headers: {
                        'Authorization': tg.initData,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.data) {
                        userSettings = result.data;
                        applyUserSettings(userSettings);
                    }
                } else {
                    console.error('Failed to load user settings:', response.status);
                }
            } catch (error) {
                console.error('Error loading user settings:', error);
            }
        }

        // Load today's nutrition data from API
        async function loadDailyNutrition() {
            try {
                const response = await fetch('/api/nutrition/daily', {
                    method: 'GET',
                    headers: {
                        'Authorization': tg.initData,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.data) {
                        waterAmount = result.data.water_ml || 0;
                        currentCalories = result.data.calories || 0;
                        currentProtein = result.data.protein || 0;
                        currentFats = result.data.fats || 0;
                        currentCarbs = result.data.carbs || 0;

                        // Clear history when loading initial data
                        waterHistory = [];
                        document.getElementById('undoWaterBtn').disabled = true;

                        // Update displays
                        document.getElementById('waterCurrent').textContent = `${waterAmount} –º–ª`;
                        updateWaterProgressBar();
                        updateMacrosRings();
                        updateMacrosDisplay();
                    }
                } else {
                    console.error('Failed to load daily nutrition:', response.status);
                }
            } catch (error) {
                console.error('Error loading daily nutrition:', error);
            }
        }

        // Load today's meals list
        async function loadMealsList() {
            try {
                const response = await fetch('/api/nutrition/meals', {
                    method: 'GET',
                    headers: {
                        'Authorization': tg.initData,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.data) {
                        displayMealsList(result.data);
                    }
                } else {
                    console.error('Failed to load meals list:', response.status);
                }
            } catch (error) {
                console.error('Error loading meals list:', error);
            }
        }

        // Display meals list
        function displayMealsList(meals) {
            const mealsEmpty = document.getElementById('mealsEmpty');
            const mealsList = document.getElementById('mealsList');

            if (meals.length === 0) {
                mealsEmpty.style.display = 'block';
                mealsList.innerHTML = '';
            } else {
                mealsEmpty.style.display = 'none';
                mealsList.innerHTML = meals.map(meal => {
                    const date = new Date(meal.created_at);
                    const time = date.toLocaleTimeString('uk-UA', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    return `
                        <div class="meal-item">
                            <div class="meal-header">
                                <span class="meal-time">${time}</span>
                                <span class="meal-calories">${meal.calories} –∫–∫–∞–ª</span>
                            </div>
                            <div class="meal-macros">
                                <span class="meal-macro protein">üîµ ${meal.protein}–≥</span>
                                <span class="meal-macro fat">üü† ${meal.fats}–≥</span>
                                <span class="meal-macro carbs">üü¢ ${meal.carbs}–≥</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Apply user settings to UI
        function applyUserSettings(settings) {
            if (settings.daily_water_ml) {
                waterGoal = settings.daily_water_ml;
                updateWaterGoalDisplay();
            }
            if (settings.daily_calories) {
                caloriesGoal = settings.daily_calories;
            }
            if (settings.daily_protein) {
                proteinGoal = settings.daily_protein;
            }
            if (settings.daily_fats) {
                fatsGoal = settings.daily_fats;
            }
            if (settings.daily_carbs) {
                carbsGoal = settings.daily_carbs;
            }

            // Update displays with new goals
            updateWaterProgressBar();
            updateMacrosRings();
            updateMacrosDisplay();
        }

        // Water buttons
        document.querySelectorAll('.water-btn:not(.undo-water)').forEach(btn => {
            btn.addEventListener('click', () => {
                const amount = parseInt(btn.dataset.amount);
                updateWater(amount);
            });
        });

        // Undo button
        document.getElementById('undoWaterBtn').addEventListener('click', () => {
            undoWater();
        });

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                const href = item.getAttribute('href');

                if (href === '#') {
                    e.preventDefault();
                    tg.showAlert('–†–æ–∑–¥—ñ–ª –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–µ–∑–∞–±–∞—Ä–æ–º!');
                } else if (href && href !== '/nutrition') {
                    // Allow navigation to other pages
                    return;
                } else {
                    e.preventDefault();
                }

                if (tg.HapticFeedback) {
                    tg.HapticFeedback.selectionChanged();
                }
            });
        });

        // Photo button
        document.querySelector('.photo-btn').addEventListener('click', () => {
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }
            // TODO: Open camera or file picker
            tg.showAlert('–§—É–Ω–∫—Ü—ñ—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–æ—Ç–æ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–µ–∑–∞–±–∞—Ä–æ–º!');
        });

        // Edit button - open meal entry page
        document.querySelector('.edit-btn').addEventListener('click', () => {
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }

            // Navigate to meal entry page within webapp
            window.location.href = '/meal-entry';
        });

        // Listen for page visibility to reload data when returning
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                // Page became visible - reload data
                loadDailyNutrition();
                loadMealsList();
            }
        });

        // Initialize
        setCurrentDate();
        updateMacrosRings();
        updateMacrosDisplay();

        // Load user settings and today's nutrition data
        loadUserSettings();
        loadDailyNutrition();
        loadMealsList();

        // Back button handler
        tg.BackButton.onClick(() => {
            tg.close();
        });
    </script>
</body>
</html>
